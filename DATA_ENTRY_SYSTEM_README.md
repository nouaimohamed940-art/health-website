# نظام مدخلي البيانات - Data Entry System

## نظرة عامة
تم إضافة نظام مدخلي البيانات إلى نظام إدارة القوى العاملة الصحية. يتيح هذا النظام لمدخلي البيانات في كل مركز (38 مركز) إدخال البيانات مع الحاجة لموافقة مدير المركز.

## المكونات الجديدة

### 1. جداول قاعدة البيانات
تم إنشاء 4 جداول جديدة:

#### `data_entry_users` - مدخلي البيانات
- **الغرض**: تخزين حسابات مدخلي البيانات
- **العدد**: 38 مدخل بيانات (واحد لكل مركز)
- **الحقول الرئيسية**:
  - `id`: المعرف الفريد
  - `center_id`: معرف المركز
  - `username`: اسم المستخدم
  - `email`: البريد الإلكتروني
  - `password_hash`: كلمة المرور المشفرة
  - `full_name`: الاسم الكامل
  - `is_active`: حالة الحساب

#### `data_entry_requests` - طلبات إدخال البيانات
- **الغرض**: تخزين الطلبات المرسلة من مدخلي البيانات
- **الحقول الرئيسية**:
  - `id`: المعرف الفريد
  - `center_id`: معرف المركز
  - `data_entry_user_id`: معرف مدخل البيانات
  - `request_type`: نوع الطلب (workforce, transfer, sick_leave, leave, delegation, report)
  - `table_name`: اسم الجدول المستهدف
  - `data_json`: البيانات بصيغة JSON
  - `status`: حالة الطلب (pending, approved, rejected)
  - `approved_by`: من وافق على الطلب
  - `approved_at`: تاريخ الموافقة

#### `data_entry_activity_log` - سجل الأنشطة
- **الغرض**: تسجيل جميع أنشطة مدخلي البيانات
- **الحقول الرئيسية**:
  - `id`: المعرف الفريد
  - `data_entry_user_id`: معرف مدخل البيانات
  - `center_id`: معرف المركز
  - `activity_type`: نوع النشاط
  - `description`: وصف النشاط
  - `ip_address`: عنوان IP
  - `user_agent`: معلومات المتصفح

#### `data_entry_settings` - إعدادات مدخلي البيانات
- **الغرض**: إعدادات خاصة بكل مركز
- **الحقول الرئيسية**:
  - `center_id`: معرف المركز
  - `require_manager_approval`: هل يتطلب موافقة المدير
  - `max_daily_entries`: الحد الأقصى للإدخالات اليومية

### 2. الصفحات الجديدة

#### `data_entry_login.php` - تسجيل دخول مدخلي البيانات
- **الغرض**: صفحة تسجيل دخول مخصصة لمدخلي البيانات
- **المميزات**:
  - تصميم احترافي ومتجاوب
  - حسابات تجريبية للاختبار
  - تسجيل أنشطة تسجيل الدخول
  - ربط مع المركز المخصص

#### `data_entry_dashboard.php` - لوحة تحكم مدخلي البيانات
- **الغرض**: لوحة التحكم الرئيسية لمدخلي البيانات
- **المميزات**:
  - إحصائيات الطلبات المرسلة
  - روابط سريعة لإدخال البيانات
  - عرض آخر الطلبات المرسلة
  - تصميم احترافي ومتجاوب

#### `data_entry_workforce.php` - إدخال بيانات القوى العاملة
- **الغرض**: إدخال إحصائيات الموظفين
- **الحقول**:
  - إجمالي الموظفين
  - الموظفين النشطين
  - الموظفين غير النشطين
  - المعينين هذا الشهر
  - المستقيلين هذا الشهر
  - ملاحظات إضافية

#### `data_entry_transfers.php` - إدخال بيانات النقل والتكليف
- **الغرض**: إدخال بيانات تنقلات الموظفين
- **الحقول**:
  - اسم الموظف
  - رقم الموظف
  - المنصب الحالي والجديد
  - نوع الحركة (نقل، ترقية، تكليف، إعارة، تناوب)
  - تاريخ الحركة
  - الأقسام (من وإلى)
  - سبب الحركة
  - ملاحظات

#### `approval_requests.php` - موافقة الطلبات
- **الغرض**: صفحة مديري المراكز لمراجعة وموافقة الطلبات
- **المميزات**:
  - عرض جميع الطلبات المعلقة
  - إمكانية الموافقة أو الرفض
  - إضافة ملاحظات للموافقة/الرفض
  - إحصائيات الطلبات
  - تصميم احترافي مع modals

### 3. الإجراءات المخزنة (Stored Procedures)

#### `ApproveDataEntryRequest`
- **الغرض**: موافقة على طلب إدخال البيانات
- **الوظائف**:
  - تحديث حالة الطلب إلى "approved"
  - إدراج البيانات في الجدول المناسب
  - تسجيل من وافق ومتى

#### `RejectDataEntryRequest`
- **الغرض**: رفض طلب إدخال البيانات
- **الوظائف**:
  - تحديث حالة الطلب إلى "rejected"
  - تسجيل سبب الرفض

#### `LogDataEntryActivity`
- **الغرض**: تسجيل أنشطة مدخلي البيانات
- **الوظائف**:
  - تسجيل تسجيل الدخول/الخروج
  - تسجيل إرسال الطلبات
  - تسجيل الموافقة/الرفض

### 4. المستخدمين الجدد

#### `data_entry_user`
- **الصلاحيات**: إدخال البيانات فقط
- **الوصول**: مراكزهم فقط
- **الوظائف**:
  - إدخال البيانات
  - عرض طلباتهم
  - تسجيل الأنشطة

#### `center_manager_approver`
- **الصلاحيات**: مراجعة وموافقة الطلبات
- **الوصول**: مراكزهم فقط
- **الوظائف**:
  - مراجعة الطلبات
  - الموافقة/الرفض
  - إدراج البيانات المعتمدة

## تدفق العمل

### 1. تسجيل دخول مدخل البيانات
1. يذهب مدخل البيانات إلى `data_entry_login.php`
2. يدخل اسم المستخدم وكلمة المرور
3. يتم التحقق من صحة البيانات
4. يتم تسجيل نشاط تسجيل الدخول
5. يتم التوجيه إلى `data_entry_dashboard.php`

### 2. إدخال البيانات
1. يختار مدخل البيانات نوع البيانات المراد إدخالها
2. يملأ النموذج بالبيانات المطلوبة
3. يرسل البيانات
4. يتم إنشاء طلب في `data_entry_requests`
5. يتم تسجيل النشاط في `data_entry_activity_log`
6. يتم عرض رسالة نجاح

### 3. مراجعة وموافقة المدير
1. يذهب مدير المركز إلى `approval_requests.php`
2. يرى جميع الطلبات المعلقة لمركزه
3. يختار طلب للمراجعة
4. يقرر الموافقة أو الرفض
5. يضيف ملاحظات (اختياري)
6. يتم تحديث حالة الطلب
7. إذا وافق، يتم إدراج البيانات في الجدول المناسب

## الأمان

### 1. التحقق من الصلاحيات
- مدخلي البيانات يمكنهم رؤية بيانات مراكزهم فقط
- مديري المراكز يمكنهم مراجعة طلبات مراكزهم فقط
- كل طلب مرتبط بمركز محدد

### 2. تشفير البيانات
- كلمات المرور مشفرة باستخدام `password_hash()`
- البيانات الحساسة محمية

### 3. تسجيل الأنشطة
- جميع الأنشطة مسجلة مع IP و User Agent
- يمكن تتبع جميع العمليات

## التصميم

### 1. التصميم المتجاوب
- يعمل على جميع الأجهزة
- تصميم mobile-first
- ألوان متسقة ومهنية

### 2. تجربة المستخدم
- واجهات سهلة الاستخدام
- رسائل واضحة
- تأثيرات تفاعلية
- تحقق من صحة البيانات

### 3. إمكانية الوصول
- دعم قارئات الشاشة
- تباين ألوان جيد
- تنقل بالكيبورد

## الاختبار

### حسابات تجريبية
- `de_imc01` / `password` - مدخل بيانات الطب الباطني KFSH
- `de_emc01` / `password` - مدخل بيانات الطوارئ KFSH
- `de_surg01` / `password` - مدخل بيانات الجراحة KFSH

### سيناريوهات الاختبار
1. تسجيل دخول مدخل البيانات
2. إدخال بيانات القوى العاملة
3. إدخال بيانات النقل والتكليف
4. مراجعة الطلبات من مدير المركز
5. الموافقة على الطلبات
6. رفض الطلبات

## الصيانة

### 1. النسخ الاحتياطي
- نسخ احتياطي منتظم لقاعدة البيانات
- نسخ احتياطي للملفات

### 2. المراقبة
- مراقبة سجلات الأخطاء
- مراقبة أنشطة المستخدمين
- مراقبة أداء النظام

### 3. التحديثات
- تحديثات أمنية منتظمة
- تحسينات الأداء
- إضافة ميزات جديدة

## الدعم الفني

### 1. استكشاف الأخطاء
- فحص سجلات الأخطاء
- اختبار الاتصال بقاعدة البيانات
- التحقق من الصلاحيات

### 2. التدريب
- دليل المستخدم
- فيديوهات تعليمية
- جلسات تدريبية

### 3. التواصل
- نظام تذاكر الدعم
- بريد إلكتروني للدعم
- هاتف للدعم الطارئ

---

## ملاحظات مهمة

1. **الأمان**: جميع البيانات محمية ومشفرة
2. **الأداء**: النظام محسن للأداء العالي
3. **القابلية للتوسع**: يمكن إضافة مراكز جديدة بسهولة
4. **المرونة**: يمكن تخصيص النظام حسب الحاجة
5. **الموثوقية**: نظام احتياطي ونسخ احتياطية منتظمة

هذا النظام يوفر حلاً شاملاً وآمناً لإدارة بيانات القوى العاملة الصحية مع ضمان الدقة والموثوقية.
